<!DOCTYPE html>
<html>
<head>
    <title>Practical VR Lab: Stefan's Law Verification</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        /* Style for the UI slider (appears on desktop screen, outside of VR) */
        #ui-container {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            padding: 10px 20px;
            border-radius: 8px;
            color: black;
            z-index: 1000;
            font-family: sans-serif;
            text-align: center;
        }
    </style>
</head>
<body>

    <script>
        AFRAME.registerComponent('stefans-law-verifier', {
            schema: {
                temperatureK: { type: 'number', default: 500 },
                emissivity: { type: 'number', default: 0.95 }, 
                radiatorEl: { type: 'selector' },
                fluxTextEl: { type: 'selector' },
                tempTextEl: { type: 'selector' },
            },
            STEFAN_BOLTZMANN_CONSTANT: 5.670374419e-8,
            BASE_FLUX_INTENSITY: 0.0001,

            init: function () {
                this.updateSimulation(this.data.temperatureK);
            },
            updateSimulation: function (newTempK) {
                const T = newTempK;
                const T_ambient = 300; 
                const epsilon = this.data.emissivity;

                // Stefan's Law: M ∝ T⁴
                const radiantExitance = epsilon * this.STEFAN_BOLTZMANN_CONSTANT * (Math.pow(T, 4) - Math.pow(T_ambient, 4));
                
                // Scale Exitance for visible glow effect
                const visualIntensity = Math.max(0.1, radiantExitance * this.BASE_FLUX_INTENSITY);
                
                // Update Radiator Glow
                if (this.data.radiatorEl) {
                    this.data.radiatorEl.setAttribute('material', 'emissiveIntensity', visualIntensity.toFixed(2));
                }

                // Update Text Displays (Meters)
                if (this.data.fluxTextEl) {
                    const fluxDisplay = (radiantExitance / 1000).toFixed(3); 
                    this.data.fluxTextEl.setAttribute('text', 'value', `Flux (M): ${fluxDisplay} kW/m²`);
                }
                if (this.data.tempTextEl) {
                    this.data.tempTextEl.setAttribute('text', 'value', `Temp (T): ${T.toFixed(0)} K`);
                }
            },
            setTemperature: function (tempK) {
                this.data.temperatureK = parseFloat(tempK);
                this.updateSimulation(this.data.temperatureK);
            }
        });
    </script>

    <a-scene background="color: #BBBBBB">

        <a-entity id="ExperimentManager" stefans-law-verifier="
            radiatorEl: #RadiatingSurface; 
            fluxTextEl: #FluxReadout;
            tempTextEl: #TempReadout;
        "></a-entity>

        <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" 
                 color="#CCCCCC" material="shader: standard; roughness: 0.8"></a-plane>
                 
        <a-entity light="type: ambient; color: #FFFFFF; intensity: 1.0"></a-entity>
        

        <a-entity id="LabTable">
            <a-box position="0 0.75 0" width="3.5" height="0.05" depth="1.5"
                   material="color: #5D4037; shader: standard; roughness: 0.8;"></a-box>
            <a-box position="1.65 0.375 0.7" width="0.1" height="0.75" depth="0.1" color="#5D4037"></a-box>
            <a-box position="-1.65 0.375 0.7" width="0.1" height="0.75" depth="0.1" color="#5D4037"></a-box>
            <a-box position="1.65 0.375 -0.7" width="0.1" height="0.75" depth="0.1" color="#5D4037"></a-box>
            <a-box position="-1.65 0.375 -0.7" width="0.1" height="0.75" depth="0.1" color="#5D4037"></a-box>

            <a-box position="0 0.80 0" width="3.0" height="0.05" depth="0.15" 
                   material="color: #AAAAAA; metalness: 0.8; roughness: 0.1;"></a-box>
        </a-entity>

        <a-entity position="-0.8 0.85 0">
            <a-box width="0.1" height="0.1" depth="0.2" color="#666666"></a-box>
            <a-cylinder position="0 0.25 0" radius="0.05" height="0.3" color="#333333"></a-cylinder>
            <a-sphere id="RadiatingSurface"
                position="0 0.45 0" radius="0.08" 
                material="
                    color: #FF7700;         
                    shader: standard; 
                    emissive: #FF5500;      
                    emissiveIntensity: 0.5; /* Dynamic control by script */
                    roughness: 0.5;
                ">
                <a-text value="Radiator (T)" align="center" 
                        position="0 0.2 0" width="1" color="#000000" font="roboto"></a-text>
            </a-sphere>
            <a-light type="point" color="#FF3333" intensity="0.4" position="0 1.3 -0.5"></a-light>
        </a-entity>


        <a-entity position="0.8 0.85 0">
            <a-box width="0.1" height="0.1" depth="0.2" color="#666666"></a-box>
            <a-cylinder position="0 0.25 0" radius="0.08" height="0.4" rotation="90 0 0" color="#333333"></a-cylinder>
            <a-plane position="0 0.25 0.2" width="0.1" height="0.1" rotation="0 0 0" 
                     material="color: #111111; roughness: 0.1;"></a-plane>
            <a-text value="Thermopile (M)" align="center" 
                    position="0 0.5 0" width="1" color="#000000" font="roboto"></a-text>
        </a-entity>


        <a-entity id="LabEquipment">
            <a-box position="-1.5 0.90 -0.5" width="0.5" height="0.3" depth="0.3" 
                   material="color: #444455; roughness: 0.5;"></a-box>
            <a-box position="-1.5 0.90 -0.5" width="0.05" height="0.05" depth="0.05" color="#CCCCCC"></a-box>
            
            <a-box position="-1.2 0.85 0.7" width="0.3" height="0.15" depth="0.05" rotation="0 -30 0" 
                   material="color: #555555; roughness: 0.5;">
                   <a-plane position="0 0.05 0.026" width="0.2" height="0.08" color="#00AA00"></a-plane>
                   <a-text id="TempReadout" value="Temp (T): 500 K" align="center" 
                           position="0 0.05 0.03" rotation="0 0 0" width="0.3" 
                           color="#000000" font="roboto" negate="true"></a-text>
            </a-box>

            <a-box position="1.2 0.85 0.7" width="0.3" height="0.15" depth="0.05" rotation="0 30 0"
                   material="color: #555555; roughness: 0.5;">
                   <a-plane position="0 0.05 0.026" width="0.2" height="0.08" color="#00AA00"></a-plane>
                   <a-text id="FluxReadout" value="Flux (M): 0.540 kW/m²" align="center" 
                           position="0 0.05 0.03" rotation="0 0 0" width="0.3" 
                           color="#000000" font="roboto" negate="true"></a-text>
            </a-box>
        </a-entity>


        <a-camera position="0 1.6 2.5">
            <a-cursor color="#000000" fuse="false" scale="0.01 0.01 0.01"></a-cursor>
        </a-camera>

    </a-scene>

    <div id="ui-container">
        <h3>Source Temperature Controller (T)</h3>
        <p>Stefan's Law Verification: Use the slider to change T (Source Temperature) and observe the T⁴ relationship in the Flux (M) readout.</p>
        <label for="temp-slider">Temperature (K):</label>
        <input type="range" id="temp-slider" min="300" max="1500" value="500" step="50" 
               oninput="document.querySelector('#ExperimentManager').components['stefans-law-verifier'].setTemperature(this.value)">
    </div>

</body>
</html>